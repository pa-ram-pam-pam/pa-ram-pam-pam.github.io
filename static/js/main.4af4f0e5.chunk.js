(this.webpackJsonp017=this.webpackJsonp017||[]).push([[0],{33:function(e,t,n){e.exports=n(57)},57:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),a=n(18),c=n.n(a),u=n(7),i=n(9),l=n(2),h=n(31),O={LOAD_PHOTOS:"LOAD_PHOTOS",LOAD_ONE_PHOTO:"LOAD_ONE_PHOTO",SHOW_BIG_PHOTO:"SHOW_BIG_PHOTO",SET_ERROR:"SET_ERROR",TOGGLE_LIKE_PHOTO:"TOGGLE_LIKE_PHOTO",TOGGLE_AUTHORIZATION:"TOGGLE_AUTHORIZATION",FROM_URL:"FROM_URL"},f=n(10),s=new(n.n(f).a)({accessKey:"KJOvYEYwLUqBqwO2elNDQlVbvpovCUF0gxnLu9Uql6M",secret:"oY014JiJh1zZyhhd9ngAWmLMB0RDfOBbVEH2ghladaA",callbackUrl:"https://pa-ram-pam-pam.github.io/auth"}),d=O.LOAD_PHOTOS,p=O.LOAD_ONE_PHOTO,m=O.SET_ERROR,E=O.SHOW_BIG_PHOTO,b=O.TOGGLE_LIKE_PHOTO,g=O.TOGGLE_AUTHORIZATION,_=O.FROM_URL,A=function(){return function(e,t){var n=++t().counter;s.search.photos("cats",n,10).then(f.toJson).then((function(t){e(k(t))})).catch((function(t){e(L())}))}},T=function(e){return{type:b,payload:e}},v=function(e){return{type:g,payload:e}},j=function(e){return{type:_,payload:e}},k=function(e){return{type:d,payload:e.results}},P=function(e){return{type:p,payload:e}},L=function(e){return{type:m,payload:e}},y=n(16),z=Object(y.a)((function(e){return e.pageY}),(function(e){return e})),H=Object(y.a)((function(e){return e.photoMap}),(function(e){return e})),M=Object(y.a)((function(e){return e.authorized}),(function(e){return e})),U=Object(y.a)((function(e){return e.fromUrl}),(function(e){return e})),w=function(e){var t=e.photo,n=t.user,o=n.name,a=n.links.html.authorLink,c=t.created_at,u=t.likes;return r.a.createElement("div",null,r.a.createElement("div",null,"\u0410\u0432\u0442\u043e\u0440:",r.a.createElement("a",{href:a},o)),r.a.createElement("div",null,"\u0414\u0430\u0442\u0430: ",c),r.a.createElement("div",null,"\u041b\u0430\u0439\u043a\u043e\u0432: ",u))},R=function(e){var t=e.photo,n=e.selectPhoto,o=t.id,a=t.description,c=t.urls.small;return r.a.createElement("div",{key:o},r.a.createElement(i.b,{to:"/view/"+o,onClick:function(){n(window.pageYOffset)}},r.a.createElement("img",{src:c,alt:a})),r.a.createElement(w,{photo:t}))},I=n(20),G=function(e){var t=e.authorized,n=e.createActionToggleAuthorization,a=e.id,c=e.createActionFromUrl,u=Object(o.useState)(),i=Object(I.a)(u,2),h=i[0],O=i[1],f=function(){t?n():(c(a),O(!0))};return h?r.a.createElement(l.a,{to:"/preauth"}):t?r.a.createElement("button",{onClick:f},"\u0412\u044b\u0439\u0442\u0438"):r.a.createElement("button",{onClick:f},"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f")},S=Object(u.b)((function(e){return{pageY:z(e),photoMap:H(e),authorized:M(e)}}),(function(e){return{loadPhotos:function(){return e(A())},createActionShowMeBigPhoto:function(t){return e(function(e){return{type:E,pageY:e}}(t))},createActionToggleAuthorization:function(){return e(v())},createActionFromUrl:function(t){return e(j(t))}}}))((function(e){var t=e.loadPhotos,n=e.createActionShowMeBigPhoto,a=e.pageY,c=e.photoMap,u=e.authorized,i=e.createActionToggleAuthorization,l=Object(o.useCallback)((function(e){window.innerHeight+document.documentElement.scrollTop===document.documentElement.offsetHeight&&(e.preventDefault(),t())}),[t]);Object(o.useEffect)((function(){window.scrollTo(0,a)}),[a]),Object(o.useEffect)((function(){return window.addEventListener("scroll",l),function(){return window.removeEventListener("scroll",l)}}),[l]);if(void 0===c.size)return t(),null;var O,f=[],s=Object(h.a)(c.values());try{for(s.s();!(O=s.n()).done;){var d=O.value;f.push(r.a.createElement(R,{key:d.id,photo:d,selectPhoto:n}))}}catch(p){s.e(p)}finally{s.f()}return r.a.createElement("div",{onScroll:t},r.a.createElement(G,{authorized:u,createActionToggleAuthorization:i,createActionFromUrl:j}),f,r.a.createElement("br",null),r.a.createElement("button",{onClick:function(e){e.preventDefault(),e.target.blur(),t()}},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0435\u0449\u0435 \u0444\u043e\u0442\u043e\u0447\u0435\u043a"))})),F=function(e){var t=e.liked,n=e.handleClickButton;return t?r.a.createElement("button",{onClick:n},"\u0423\u0431\u0440\u0430\u0442\u044c \u043b\u0430\u0439\u043a"):r.a.createElement("button",{onClick:n},"\u041f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043b\u0430\u0439\u043a")},B=function(e){var t=e.id,n=e.toggleLikePhoto,o=e.photo,a=e.authorized,c=e.createActionToggleAuthorization,u=e.createActionFromUrl,l=null===o||void 0===o?void 0:o.liked_by_user,h=o.description,O=o.urls.regular;return r.a.createElement("div",null,r.a.createElement("h2",null,"\u0411\u043e\u043b\u044c\u0448\u0430\u044f \u0444\u043e\u0442\u043e\u0447\u043a\u0430"),r.a.createElement(G,{id:t,authorized:a,createActionToggleAuthorization:c,createActionFromUrl:u}),r.a.createElement(w,{photo:o}),r.a.createElement("div",null,r.a.createElement("img",{src:O,alt:h}),r.a.createElement("br",null),a?r.a.createElement(F,{liked:l,handleClickButton:function(){n(t)}}):null),r.a.createElement(i.b,{to:"/feed"}," \u041d\u0430\u0437\u0430\u0434 "))},D=Object(u.b)((function(e){return{photoMap:H(e),authorized:M(e)}}),(function(e){return{toggleLikePhoto:function(t){return e(function(e){return function(t,n){n().photoMap.get(e).liked_by_user?s.photos.unlikePhoto(e).then(f.toJson).then((function(){t(T(e))})):s.photos.likePhoto(e).then(f.toJson).then((function(){t(T(e))}))}}(t))},createActionToggleAuthorization:function(){return e(v())},createActionFromUrl:function(t){return e(j(t))},loadPhotos:function(t){return e(A())},loadOnePhoto:function(t){return e(function(e){return function(t){s.photos.getPhoto(e).then(f.toJson).then((function(e){t(P(e))})).catch((function(e){t(L())}))}}(t))}}}))((function(e){var t=e.photoMap,n=e.authorized,a=e.createActionToggleAuthorization,c=e.createActionFromUrl,u=e.loadOnePhoto,i=e.toggleLikePhoto,h=Object(l.g)().id;if(Object(o.useEffect)((function(){void 0===t.size&&u(h)}),[h,u,t.size]),void 0===t.size)return null;var O=t.get(h);return r.a.createElement("div",null,r.a.createElement(B,{photo:O,id:h,authorized:n,createActionToggleAuthorization:a,createActionFromUrl:c,toggleLikePhoto:i}))})),Y=Object(u.b)(null,(function(e){return{createActionToggleAuthorization:function(){return e(v())}}}))((function(e){var t,n=e.createActionToggleAuthorization,a=Object(o.useState)(),c=Object(I.a)(a,2),u=c[0],i=c[1],h=localStorage.getItem("fromPhotoId");return t="null"!==h?"/view/"+h:"/feed",Object(o.useEffect)((function(){var e=document.location.search.split("code=")[1];e&&s.auth.userAuthentication(e).then((function(e){return e.json()})).then((function(e){n(),s.auth.setBearerToken(e.access_token),i(!0)}))})),u?(localStorage.setItem("fromPhotoId",null),r.a.createElement(l.a,{to:t})):null})),C=Object(u.b)((function(e){return{fromUrl:U(e)}}),null)((function(e){var t=e.fromUrl;t&&localStorage.setItem("fromPhotoId",t);var n=s.auth.getAuthenticationUrl(["public","write_likes"]);return document.location.assign(n),null})),J=Object(u.b)(null,null)((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,null,r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"/preauth",component:C}),r.a.createElement(l.b,{path:"/auth",component:Y}),r.a.createElement(l.b,{path:"/feed",component:S}),r.a.createElement(l.b,{path:"/view/:id",component:D}),r.a.createElement(l.a,{from:"/",to:"/feed"}))))})),N=n(14),K=n(21),W=n(3),Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O.LOAD_ONE_PHOTO:var n=new Map;return n.set(t.payload.id,t.payload),Object(W.a)(Object(W.a)({},e),{},{photoMap:n});case O.LOAD_PHOTOS:var o=t.payload.map((function(e){return[e.id,e]})),r=Object(K.a)(e.photoMap),a=new Map([].concat(Object(K.a)(r),Object(K.a)(o)));return Object(W.a)(Object(W.a)({},e),{},{counter:++e.counter,errMessage:null,photoMap:a});case O.SHOW_BIG_PHOTO:return Object(W.a)(Object(W.a)({},e),{},{pageY:t.pageY});case O.TOGGLE_AUTHORIZATION:return Object(W.a)(Object(W.a)({},e),{},{authorized:!e.authorized});case O.FROM_URL:return Object(W.a)(Object(W.a)({},e),{},{fromUrl:t.payload});case O.SET_ERROR:return Object(W.a)(Object(W.a)({},e),{},{errMessage:t.payload});case O.TOGGLE_LIKE_PHOTO:var c=new Map(e.photoMap),u=c.get(t.payload);return!1===u.liked_by_user?(u.liked_by_user=!0,u.likes=++u.likes):(u.liked_by_user=!1,u.likes=--u.likes),Object(W.a)(Object(W.a)({},e),{},{photoMap:c});default:return e}},q=n(32),x=Object(N.c)(Z,{photoMap:[],counter:0,errMessage:null,pageY:0,authorized:!1,fromUrl:""},Object(N.a)(q.a));c.a.render(r.a.createElement(u.a,{store:x},r.a.createElement(J,null)),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.4af4f0e5.chunk.js.map